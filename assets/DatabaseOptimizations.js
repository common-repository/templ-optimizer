import{N as w,f as O,T as C}from"./TemplHr.js";import{d as y,u as x,s as D,r as L,a as N,c as z,o as _,b as c,e as i,t as o,n as T,f,g,w as V,h as $,i as B,_ as k,j as S,F as h,k as I,l as j}from"./index.js";import{T as F}from"./TemplButton.js";import"./Checkmark.js";const H=[{tool:"delete_trashed_posts",priority:100,name:"message.database_optimizations.delete_trashed_posts.name",desc:"message.database_optimizations.delete_trashed_posts.desc",action:"message.database_optimizations.delete_trashed_posts.action",success:"message.database_optimizations.delete_trashed_posts.success"},{tool:"delete_revisions",priority:100,name:"message.database_optimizations.delete_revisions.name",desc:"message.database_optimizations.delete_revisions.desc",action:"message.database_optimizations.delete_revisions.action",success:"message.database_optimizations.delete_revisions.success"},{tool:"delete_auto_drafts",priority:100,name:"message.database_optimizations.delete_auto_drafts.name",desc:"message.database_optimizations.delete_auto_drafts.desc",action:"message.database_optimizations.delete_auto_drafts.action",success:"message.database_optimizations.delete_auto_drafts.success"},{tool:"delete_orphaned_postmeta",priority:100,name:"message.database_optimizations.delete_orphaned_postmeta.name",desc:"message.database_optimizations.delete_orphaned_postmeta.desc",action:"message.database_optimizations.delete_orphaned_postmeta.action",success:"message.database_optimizations.delete_orphaned_postmeta.success"},{tool:"delete_expired_transients",priority:100,name:"message.database_optimizations.delete_expired_transients.name",desc:"message.database_optimizations.delete_expired_transients.desc",action:"message.database_optimizations.delete_expired_transients.action",success:"message.database_optimizations.delete_expired_transients.success"},{tool:"drop_tables_with_different_prefix",priority:100,name:"message.database_optimizations.drop_tables_with_different_prefix.name",desc:"message.database_optimizations.drop_tables_with_different_prefix.desc",action:"message.database_optimizations.drop_tables_with_different_prefix.action",success:"message.database_optimizations.drop_tables_with_different_prefix.success"},{tool:"convert_to_innodb",priority:100,name:"message.database_optimizations.convert_to_innodb.name",desc:"message.database_optimizations.convert_to_innodb.desc",action:"message.database_optimizations.convert_to_innodb.action",success:"message.database_optimizations.convert_to_innodb.success"},{tool:"optimize_tables",priority:100,name:"message.database_optimizations.optimize_tables.name",desc:"message.database_optimizations.optimize_tables.desc",action:"message.database_optimizations.optimize_tables.action",success:"message.database_optimizations.optimize_tables.success"}],M={class:"templ-optimizer-tool"},q={class:"title-container"},E=["innerHTML"],R={key:0},A=y({__name:"DatabaseOptimization",props:{optimization:{type:Object,required:!0}},setup(l){const r=l,m=x(),{data:p}=D(m),n=L(null),s=N({loading:!1,completed:!1}),t=z(()=>{let e={count:!1,tableList:!1,prefix:!1},a=p.value.current_stats[r.optimization.tool];return typeof a=="object"?(e.count=parseInt(a.count),e.tableList=a.table_list,e.prefix=a.prefix):r.optimization.tool=="optimize_tables"||(e.count=parseInt(a)),e}),v=e=>{s.loading=!0;let a=t.value.count;B(e).then(d=>{m.setData(d.data);let u=d.data.current_stats[e],b=a-u;e=="drop_tables_with_different_prefix"||e=="convert_to_innodb"?(u=d.data.current_stats[e].count,b=a-u):e=="optimize_tables"&&(b=d.data.current_stats[e]),n.value={type:"success",message:r.optimization.success,var:b},setTimeout(()=>{n.value=null},3e3),s.completed=!0,setTimeout(()=>{s.completed=!1},1500)}).catch(d=>{console.error(d)}).finally(()=>{s.loading=!1})};return(e,a)=>(_(),c("div",M,[i("div",q,[i("h3",null,o(e.$t(l.optimization.name)),1),t.value.count!==!1?(_(),c("span",{key:0,class:T({empty:t.value.count==0})},o(t.value.count),3)):f("",!0)]),g(w,{notification:n.value},null,8,["notification"]),i("p",{innerHTML:e.$t(l.optimization.desc,{prefix:t.value.prefix})},null,8,E),t.value.tableList?(_(),c("div",R,[i("p",null,o(e.$t("message.database_optimizations.matching_tables"))+":",1),i("pre",null,"                "+o(t.value.tableList)+`
            `,1)])):f("",!0),g(F,{onClick:a[0]||(a[0]=d=>v(l.optimization.tool)),loading:s.loading,completed:s.completed,disabled:s.loading||t.value.count==0},{default:V(()=>[$(o(e.$t(l.optimization.action)),1)]),_:1},8,["loading","completed","disabled"])]))}});const G=k(A,[["__scopeId","data-v-9bb1d114"]]),J={class:"templ-optimizer-tools"},K=y({__name:"DatabaseOptimizations",setup(l){const r=z(()=>n.value?O(H,n.value):[]),m=z(()=>{var t;return n.value?(t=n.value)==null?void 0:t.current_stats.database_size:"n/a"}),p=x(),{data:n,databaseSizeChanged:s}=D(p);return(t,v)=>(_(),c("div",J,[i("h2",null,o(t.$t("message.database_optimizations.heading")),1),i("p",null,o(t.$t("message.database_optimizations.desc")),1),i("p",{class:T(["database-size",{updated:S(s)}])},[$(o(t.$t("message.database_optimizations.database_size"))+": ",1),i("span",null,o(m.value),1)],2),(_(!0),c(h,null,I(r.value,(e,a)=>(_(),c(h,{key:e.tool},[g(G,{optimization:e},null,8,["optimization"]),a!=r.value.length-1?(_(),j(C,{key:0})):f("",!0)],64))),128))]))}});const X=k(K,[["__scopeId","data-v-be22d7a4"]]);export{X as default};
